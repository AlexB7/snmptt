<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Alex  Burger">
   <meta name="GENERATOR" content="Mozilla/4.78 [en] (Windows NT 5.0; U) [Netscape]">
   <title>SNMP Trap Translator</title>
</head>
<body>
<a href="http://sourceforge.net"><img SRC="sflogo.php" ALT="SourceForge.net Logo" BORDER=0 height=62 width=210></a>
<br><b><font size=+3>SNMP Trap Translator v0.4</font></b>
<br><b>(SNMPTT)</b>
<br>This file was last updated on:&nbsp; November 18th, 2002
<p>&nbsp;<a href="#License">License</a>
<p><a href="#What is it">SNMPTT</a>
<blockquote>&nbsp;<a href="#What is it">What is it?</a>
<br>&nbsp;<a href="#Downloading">Downloading</a>
<br>&nbsp;<a href="#Features">Features</a>
<br>&nbsp;<a href="#Requirements">Requirements</a>
<br>&nbsp;<a href="#Whats New">Whats New</a>
<br>&nbsp;<a href="#Upgrading">Upgrading</a>
<br>&nbsp;<a href="#Configuration Options">Configuration Options - snmptt.ini</a>
<br>&nbsp;<a href="#Logging - Standard">Logging - Standard</a>
<br>&nbsp;<a href="#Logging - Database">Logging - Database</a>
<br>&nbsp;<a href="#Executing an external program">Executing an external
program</a>
<br>&nbsp;<a href="#Modes of Operation">Modes of Operation</a>
<br>&nbsp;<a href="#Command line arguments">Command line arguments</a>
<br>&nbsp;<a href="#SNMPTT.CONF Configuration file format">SNMPTT.CONF
Configuration file format</a>
<br>&nbsp;<a href="#SNMPTT.CONF Configuration file Notes">SNMPTT.CONF Configuration
file Notes</a>
<br>&nbsp;<a href="#Sample1 SNMPTT.CONF file">Sample1 SNMPTT.CONF file</a>
<br>&nbsp;<a href="#Sample2 SNMPTT.CONF file">Sample2 SNMPTT.CONF file</a>
<br>&nbsp;<a href="#Notes">Notes</a>
<br>&nbsp;<a href="#Installation - Unix">Installation - Unix</a>
<br>&nbsp;<a href="#Installation - Windows">Installation - Windows</a>
<br>&nbsp;<a href="#Limitations">Limitations</a>
<br>&nbsp;<a href="#Feedback">Feedback</a></blockquote>
&nbsp;<a href="#SNMP Trap Translator Convert">SNMP Trap Translator Convert</a>
<p>&nbsp;<a href="#SNMP Trap Translator Convert MIB">SNMP Trap Translator
Convert MIB</a>
<br>&nbsp;
<br>&nbsp;
<p><a NAME="License"></a><b><font size=+2>License</font></b>
<p>Copyright 2002 Alex Burger
<br>alex_b@users.sourceforge.net
<br>4/3/2002
<p>This program is free software; you can redistribute it and/or modify
<br>it under the terms of the GNU General Public License as published by
<br>the Free Software Foundation; either version 2 of the License, or
<br>(at your option) any later version.
<p>This program is distributed in the hope that it will be useful,
<br>but WITHOUT ANY WARRANTY; without even the implied warranty of
<br>MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp; See the
<br>GNU General Public License for more details.
<p>You should have received a copy of the GNU General Public License
<br>along with this program; if not, write to the Free Software
<br>Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA&nbsp; 02111-1307&nbsp;
USA
<br>&nbsp;
<p><a NAME="What is it"></a><b><font size=+2>What is it?</font></b>
<p>SNMPTT (SNMP Trap Translator) is a SNMP trap handler written in Perl
for use with the NET-SNMP / UCD-SNMP snmptrapd program (<a href="http://www.net-snmp.org">http://www.net-snmp.org)</a>.
<p>The NET-SNMP package has the ability to log SNMP traps to syslog.&nbsp;
The format of the log is basically variable = value, variable = value,
variable = value etc.&nbsp; A more descriptive / friendly trap message
can be created using SNMPTT's variable subtitution.
<p>For example, receiving the trap .1.3.6.1.4.1.232.0.3017 from a Compaq
server running the Compaq Insight Agents could result in the following
message from SNMPTT:
<p>"Compaq Drive Array Spare Drive on controller 3, bus 0, bay 3 status
is Failed."
<p>Variable substition works by defining a string such as:
<p>"Compaq Drive Array Spare Drive on controller $4, bus $5, bay $6 status
is $3."
<p>Each $<i>number</i> is replaced with the corresponding enterprise variable
received in the trap and is defined for each trap in the configuration
file.&nbsp; The order of the variables is defined in the MIB or TRAP file
which can be obtained from the vendor.
<br>&nbsp;
<p><a NAME="Downloading"></a><b><font size=+2>Downloading</font></b>
<p>SNMPTT can be downloaded from <a href="http://www.sourceforge.net/projects/snmptt">http://www.sourceforge.net/projects/snmptt</a>
<br>&nbsp;
<p><a NAME="Features"></a><b><font size=+2>Features</font></b>
<ul>
<li>
Allows unique custom actions for each trap, defined in a text configuration
file</li>

<li>
Translates received traps into a readable format by performing variable
substitution</li>

<li>
Outputs translated traps to standard output, text log file, a SQL database
and / or syslog</li>

<li>
Executes a user defined program when a trap is received</li>
</ul>

<p><br><a NAME="Requirements"></a><b><font size=+2>Requirements</font></b>
<ul>
<li>
(Tested with) Perl 5.6.1</li>

<li>
Required: NET-SNMP (formerly known as UCD-SNMP).&nbsp; Specifically <b>snmptrapd</b></li>

<li>
Required: Text::ParseWords (included with most distributions including
ActivePerl)</li>

<li>
Required: Getopt::Long (included with most distributions including ActivePerl)</li>

<li>
Required: Posix (included with most if not all distributions including
ActivePerl)</li>

<li>
Required: Config::IniFiles</li>

<li>
Optional: Sys::Syslog module</li>

<li>
Optional: DBI module.&nbsp; Required for MySQL support in Linux etc</li>

<li>
Optional: Win32::ODBC module.&nbsp; Required for ODBC (SQL etc) access
on Windows</li>

<li>
Required: Time::HiRes (only required when using SNMPTT in daemon mode -
required by <b>snmptthandler</b>)</li>
</ul>
All development and testing was done on Mandrake Linux 8.1 using UCD-SNMP
v4.2.1 (package ucd-snmp-4.2.1-5mdk.i586.rpm).&nbsp; I have also tested
the program with Windows 2000 using a test file without actually using
UCD-SNMP.&nbsp; <b>Windows users must disable the syslog feature as described
below.</b>&nbsp; Both SNMP V1 and V2 traps have been tested.
<p>UCD-SNMP v4.2.3 appears to have a bug that prevents it from working
correctly with SNMPTT.&nbsp; UCD-SNMP v4.2.1, v4.2.4 and v4.2.5 appear
to work fine.&nbsp; If you need to use UCD-SNMP v4.2.3 (if for example
you are using the Compaq supplied UCD-SNMP package) then you should at
the very least use the <b>snmptrapd</b> program from v4.2.5.
<p>Note:&nbsp;&nbsp; This script does NOT require the NET-SNMP Perl module
included in the NET-SNMP package.
<p><a NAME="Whats New"></a><b><font size=+2>Whats New</font></b>
<p><b><font size=+1>0.4 - November 18th, 2002</font></b>
<ul>
<li>
Variable substituion changes:</li>

<ul>
<li>
$X = Date, $x = Time instead of $x being both date and time</li>

<li>
$N = Event name instead of $S</li>

<li>
Added $c, $@, $O, $o, $ar, $R, $aR, $G, $S</li>
</ul>

<li>
Configuration moved to a .ini file</li>

<li>
MySQL support via DBI under Linux and Windows</li>

<li>
ODBC support via Win32::ODBC under Windows</li>
</ul>
<b><font size=+1>0.3 - September 11th, 2002</font></b>
<ul>
<li>
Daemon mode support for SNMPTT.&nbsp; When running as a daemon, SNMPTTHANDLER
script is used to spool traps from SNMPTRAPD.</li>

<li>
SNMPTTCONVERTMIB utility to convert trap / notify definitions from MIB
files</li>

<li>
Sample trap file (sample-trap) for testing</li>

<li>
Command line options to SNMPTT</li>

<li>
SNMPTT now strips UDP: and :<i>port</i> from IP addresses when using NET-SNMP
5.0+</li>

<li>
NODES files can now contain comments</li>

<li>
NODES files can now contain either host names or IP addresses</li>

<li>
You can now have multiple definitions of the same trap so that different
hosts / nodes can have different actions or one host have multiple actions</li>

<li>
Configuration file can now contain a list of other configuration files
to load</li>
</ul>
<b><font size=+1>0.2 - July 10th, 2002</font></b>
<ul>
<li>
Improved debugging output</li>

<li>
Severity substitution bug fix</li>

<li>
SNMP V2 trap bug fix</li>

<li>
UCD-SNMP v4.2.3 problem workaround</li>
</ul>
<b><font size=+1>0.1 - April 18th, 2002</font></b>
<ul>
<li>
Initial release</li>
</ul>

<p><br><a NAME="Upgrading"></a><b><font size=+2>Upgrading</font></b>
<p><b><font size=+1>v0.1, v0.2 or v0.3 to v0.4</font></b>
<p>To upgrade from v0.1, v0.2 to v0.3 to v0.4, you should:
<ol>
<li>
In your snmptt.conf file, replace all <b>$x</b> with <b>$x $X</b> (see
Whats New section)</li>

<li>
In your snmptt.conf file, replace all <b>$S</b> with <b>$N (</b>see Whats
New section)</li>

<li>
Configure the snmptt.ini as described in this file - configuration options
are no longer stored in the snmptt and snmptthandler scripts</li>

<li>
If your snmptt.conf file contained a list of other snmptt.conf files instead
of trap definitions, move that list to the snmptt.ini file</li>
</ol>

<p><br><a NAME="Configuration Options"></a><b><font size=+2>Configuration
Options - snmptt.ini</font></b>
<p>As mentioned throughout this document, configuration options are set
by editing the <b>snmptt.ini</b> file.
<p>For Linux / Unix, the <b>snmptt.ini</b> file should be located in either
<b>/etc/snmp/</b>
or <b>/etc/</b>.&nbsp; SNMPTT will search for the the file in both directories
in that order.
<p>For Windows, the file should be in <b>%SystemRoot%\</b>.&nbsp; For example,
<b>c:\winnt</b>.
<p>The location of the ini file can be set on the command line using the
<b>-ini=</b>
parameter.&nbsp; See <a href="#Command line arguments">Command Line Arguments</a>.
<p>A sample <b>snmptt.ini</b> is provided in this package.&nbsp; For Windows
NT, be sure to copy the <b>snmptt.ini-nt</b> file to <b>%SystemRoot%\snmptt.ini</b>.
<br>&nbsp;
<p><a NAME="Logging - Standard"></a><b><font size=+2>Logging - Standard</font></b>
<p>Translated traps can be sent to standard output and to a log file.&nbsp;
The output format is:
<blockquote><b>date trap-oid severity category hostname translated-trap</b></blockquote>
To configure standard output or regular logging, edit the snmptt.ini file
and modify the following variables:
<blockquote><b>enable_stdout</b>
<br><b>enable_log</b>
<br><b>log_file</b></blockquote>
Translated traps can also be sent to syslog.&nbsp; The format of the entries
will be similar to above without the date (as syslogd logs the date):
<blockquote><b>trap-oid severity category hostname translated-trap</b></blockquote>
To configure syslog, edit the snmptt ini file and modify the following
variables:
<blockquote><b>syslog_enable</b>
<br><b>syslog_facility</b>
<br><b>syslog_level</b></blockquote>
Note:&nbsp; Systems that do not support SYSLOG (such as Windows NT) must
disable syslog by setting <b>syslog_enable=0</b>..
<p>Logging of non recognized traps is also possible.&nbsp; This would be
used mainly for troubleshooting purposes.
<p>To configure unknown trap logging, edit the snmptt.ini file and modify
the following variables:
<blockquote><b>enable_unknown_trap_log</b>
<br><b>unknown_trap_log_file</b></blockquote>
<a NAME="Logging - Database"></a><b><font size=+2>Logging - Database</font></b>
<p>Translated traps can also be sent to a database.&nbsp; MySQL (tested
under Linux) and ODBC (testing under Windows NT) can be used.
<p><b><font size=+1>MySQL</font></b>
<p>To configure SNMPTT for MySQL, modify the following variables in the
snmptt.ini file.
<blockquote><b>mysql_dbi_enable</b>
<br><b>mysql_dbi_database</b>
<br><b>mysql_dbi_table</b>
<br><b>mysql_dbi_username</b>
<br><b>mysql_dbi_password</b></blockquote>
Note:&nbsp; Sample values are defined in the default ini file.
<p>The following MySQL script can create the database and table.&nbsp;
Permissions etc should also be defined.
<blockquote><b><tt>CREATE DATABASE snmptt;</tt></b>
<br><b><tt>USE snmptt;</tt></b>
<p><b><tt>DROP TABLE snmptt;;</tt></b>
<br><b><tt>CREATE TABLE snmptt (</tt></b>
<br><b><tt>eventname VARCHAR(50),</tt></b>
<br><b><tt>eventid VARCHAR(50),</tt></b>
<br><b><tt>enterprise VARCHAR(50),</tt></b>
<br><b><tt>community VARCHAR(20),</tt></b>
<br><b><tt>hostname VARCHAR(20),</tt></b>
<br><b><tt>agentip&nbsp; VARCHAR(16),</tt></b>
<br><b><tt>category VARCHAR(20),</tt></b>
<br><b><tt>severity VARCHAR(20),</tt></b>
<br><b><tt>uptime&nbsp; VARCHAR(20),</tt></b>
<br><b><tt>traptime VARCHAR(30),</tt></b>
<br><b><tt>formatline VARCHAR(255));</tt></b></blockquote>
All variables are INSERTted into the database as standard text including
the date and time.&nbsp; The variable lengths I have chosen above should
be sufficient, but they may need to be increased depending on your environment.
<p><b><font size=+1>ODBC</font></b>
<p>To configure SNMPTT for MS SQL via ODBC on Windows, modify the following
variables in the snmptt script.
<blockquote><b>sql_win32_odbc_enable = 1;</b>
<br><b>sql_win32_odbc_dsn = 'snmptt';</b>
<br><b>sql_win32_odbc_table = 'snmptt';</b>
<br><b>sql_win32_odbc_username = 'snmptt';</b>
<br><b>sql_win32_odbc_password = 'password';</b></blockquote>
Note:&nbsp; Sample values are defined in the default ini file.
<p>The following MS SQL Server script can create the table inside an existing
database.&nbsp; Permissions etc should also be defined.
<blockquote><b><tt>CREATE TABLE snmptt (</tt></b>
<br><b><tt>eventname character(50) NULL,</tt></b>
<br><b><tt>eventid&nbsp; character(50) NULL,</tt></b>
<br><b><tt>enterprise character(50) NULL,</tt></b>
<br><b><tt>community character(20) NULL,</tt></b>
<br><b><tt>hostname character(20) NULL,</tt></b>
<br><b><tt>agentip&nbsp; character(16) NULL,</tt></b>
<br><b><tt>category character(20) NULL,</tt></b>
<br><b><tt>severity character(20) NULL,</tt></b>
<br><b><tt>uptime&nbsp; character(20) NULL,</tt></b>
<br><b><tt>traptime character(30) NULL,</tt></b>
<br><b><tt>formatline character(255) NULL)</tt></b></blockquote>
All variables are INSERTted into the database as standard text including
the date and time.&nbsp; The variable lengths I have chosen above should
be sufficient, but they may need to be increased depending on your environment.
<br>&nbsp;
<p><a NAME="Executing an external program"></a><b><font size=+2>Executing
an external program</font></b>
<p>An external program can be launched when a trap is received.&nbsp; The
command line is defined in the configuration file.&nbsp; For example, to
send a page using QPAGE (<a href="http://www.qpage.org">http://www.qpage.org</a>),
the following command line could be used:
<blockquote><b>qpage -f TRAP notifygroup1 "$r $x $X Compaq Drive Array
Spare Drive on controller $4, bus $5, bay $6 status is $3."</b></blockquote>
$r is translated to the hostname, and $x is the current date, and $X is
the current time (described in detail below)
<p>To enable or diable the execution of EXEC definitions, edit the snmptt.ini
file and modify the following variable:
<blockquote><b>exec_enable</b></blockquote>

<p><br><a NAME="Modes of Operation"></a><b><font size=+2>Modes of Operation</font></b>
<p>SNMPTT can be run in two modes:&nbsp; standalone mode and daemon mode.
<p><b><font size=+1>Standalone mode</font></b>
<p>To use SNMPTT in standalone mode, the snmptrapd.conf file would contain
a traphandle statement such as:
<blockquote><b>traphandle default /usr/sbin/snmptt</b></blockquote>
When a trap is received by SNMPTRAPD, the trap is passed to the <b>/usr/sbin/snmptt</b>
script.&nbsp; SNMPTT performs the following tasks:
<ul>
<li>
reads trap passed from snmptrapd</li>

<li>
loads configuration file(s) containing trap definitions</li>

<li>
searches traps for a match</li>

<li>
logs, executes EXEC statement etc</li>

<li>
quits</li>
</ul>
With a 450 Mhz PIII and a 9000 line snmptt.conf containing 566 unique traps
(EVENTs), it takes under a second to process the trap including logging
and executing the qpage program.&nbsp; The larger the snmptt.conf file
is, the longer it will take to process.&nbsp; If there are a large number
of traps being received, daemon mode should be used.&nbsp; If it takes
1 second to process one trap, then obviously you shouldn't try to process
more than one trap per second.
<p>Running SNMPTT without the <b>--daemon</b> command line option will
result standalone mode unless the <b>mode</b> variable in the <b>snmptt.ini</b>
file is set to <b>daemon</b>.&nbsp; For standalone mode, the <b>mode</b>
variable in the <b>snmptt.ini</b> file should be set <b>standalone</b>.
<p><b><font size=+1>Daemon mode</font></b>
<p>To use SNMPTT in daemon mode, SNMPTT would be run in daemon mode and
the snmptrapd.conf file would contain a traphandle statement such as:
<blockquote><b>traphandle default /usr/sbin/snmptthandler</b></blockquote>
When a trap is received by SNMPTRAPD, the trap is passed to the /usr/sbin/snmptthandler
script.&nbsp; SNMPTTHANDLER performs the following tasks:
<ul>
<li>
reads trap passed from snmptrapd</li>

<li>
writes the trap in a new unique file to a spool directory such as /var/spool/snmptt</li>

<li>
quits</li>
</ul>
SNMPTT running in daemon mode performs the following tasks:
<ul>
<li>
loads configuration file(s) containing trap definitions at startup</li>

<li>
reads traps passed from spool directory</li>

<li>
searches traps for a match</li>

<li>
logs, executes EXEC statement etc</li>

<li>
sleeps for 5 seconds (configurable)</li>

<li>
loops back up to 'reads traps passed from spool directory'</li>
</ul>
Using SNMPTTHANDLER and SNMPTT in daemon mode, a large number of traps
per minute should be handled easily.
<p>Running SNMPTT with the --daemon command line option or setting the
<b>mode</b>
variable in the <b>snmptt.ini</b> file is set to <b>daemon</b> will cause
SNMPTT to run in daemon mode.
<p>Note:&nbsp; When running on a <b>non</b> Windows platform, SNMPTT will
fork to the background if <b>daemon_fork</b> is set to 1.
<br>&nbsp;
<p><a NAME="Command line arguments"></a><b><font size=+2>Command line arguments</font></b>
<p>The following command line arguments are supported:
<p>Usage:
<br>&nbsp;&nbsp;&nbsp; snmptt [&lt;options>]
<br>Options:
<br>&nbsp;&nbsp;&nbsp; --daemon&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Start in daemon mode
<br>&nbsp;&nbsp;&nbsp; --debug=n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Set debug level (1 or 2)
<br>&nbsp;&nbsp;&nbsp; --debugfile=filename&nbsp;&nbsp;&nbsp; Set debug
output file
<br>&nbsp;&nbsp;&nbsp; --dump&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Dump (display) defined traps
<br>&nbsp;&nbsp;&nbsp; --help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Display this message
<br>&nbsp;&nbsp;&nbsp; --ini=filename&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Specify path to snmptt.ini file
<br>&nbsp;&nbsp;&nbsp; --version&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Display author and version information
<br>&nbsp;&nbsp;&nbsp; --time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Use to see how long it takes to load and
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
process trap file (eg: time snmptt --time)
<br>&nbsp;
<p><a NAME="SNMPTT.CONF Configuration file format"></a><b><font size=+2>SNMPTT.CONF
Configuration file format</font></b>
<p>The configuration file (usually /etc/snmp/snmptt.conf or d:\snmp\snmptt.conf)
contains a list of all the defined traps.
<p>If your snmptt.conf file is getting rather large and you would like
to divide it up into many smaller files, then do the following:
<p>-create additional snmptt.conf files
<br>-add the file names to the <b>snmptt_conf_files</b> section in the
snmptt.ini file.
<p>For example:
<blockquote>snmptt_conf_files = &lt;&lt;END
<br>/etc/snmp/snmptt-compaq.conf
<br>/etc/snmp/snmptt-cisco.conf
<br>/etc/snmp/snmptt-hp.conf
<br>/etc/snmp/snmptt-3com.conf
<br>END</blockquote>
The syntax of the snmptt.conf file&nbsp; is:
<blockquote><b>EVENT</b> event_name event_OID "category" severity
<p><b>FORMAT</b> format_string
<p>[<b>EXEC</b> command_string]
<p>[<b>NODES</b> sources_list]
<p>[<b>SDESC</b>]
<br>[<b>EDESC</b>]
<p>Note: Lines starting with a # will be ignored.
<p>Note:&nbsp; The EVENT and FORMAT line are REQUIRED.&nbsp; Commands in
[] are optional.&nbsp; Do NOT include the []s in the configuration file!</blockquote>

<blockquote><b>EVENT:</b>
<blockquote><b>EVENT</b> event_name event_OID "category" severity
<p>event_name: Unique text label (alias) <b><u>containing no spaces</u></b>
<p>event_OID: Object identifier string in dotted format notation <b><u>containing
no spaces</u></b> as received by snmptrapd.
<p>For example, a Compaq (1.3.6.1.4.1.232) cpqHoGenericTrap trap (11001)
would be written as:
<p>1.3.6.1.4.1.232.0.11001.
<p>Note: SNMP V1 traps are in the format of enterprise ID (1.3.6.1.4.1.232)
followed by a 0, and then followed by the trap number
<br>(11001).
<p>Wildcards can also be used.&nbsp; For example:
<p>1.3.6.1.4.1.232.1.2.*
<p>Note: Specific trap matches are performed before wildcards so if you
have an entry for 1.3.6.1.4.1.232.1.2.5 AND 1.3.6.1.4.1.232.1.2.*, it will
process the .5 trap when received
<p>category: Character string enclosed in double "s.&nbsp; Used when logging
output (see above).
<p>If the category is "IGNORE", no action will take place even if the snmptt.conf
contains FORMAT and / or EXEC statements.
<p>If the category is "LOGONLY", the trap will be logged as usual, but
the EXEC statement will be ignored.
<p>Note:&nbsp;&nbsp; If you plan on using an external program such as Netsaint
for logging, paging etc, you probably do not want any traps defined with
LOGONLY
<p>severity: Character string of the severity of the event.&nbsp; Used
in the output when logging.&nbsp; Example: Minor, Major, Normal, Critical,
Warning
<br>&nbsp;</blockquote>
<b>FORMAT:</b>
<blockquote><b>FORMAT</b> format_string
<p>Format string to be used when logging to snmptt.log and/or syslog.
<p>Variable substitution is performed on this string using the following
variables:
<blockquote>$A, $aA - Trap agent IP address
<br>$c - Category
<br>$C - Trap community string
<br>$E, $e&nbsp; - Enterprise trap OID in number format
<br>$G&nbsp; - Generic trap number (0 if enterprise trap)
<br>$S&nbsp; - Specific trap number (0 if generic trap)
<br>$N&nbsp; - Event name defined
<br>$O, $o - Trap OID in number format
<br>$R, $r&nbsp; - Hostname
<br>$aR, $ar - IP address
<br>$s&nbsp; - Severity
<br>$T&nbsp; - Uptime:&nbsp; Time since network entity was initialized
<br>$X&nbsp; - Current time
<br>$x&nbsp; - Current date
<br>$# - Number of (how many) variable-bindings in the trap
<br>$$&nbsp; - Print a $
<br>$@ - Number of seconds since the epoch
<br>$*&nbsp; - Expand all variable-bindings
<br>$<i>n</i>&nbsp; - Expand variable-binding n (1-<i>n</i>)</blockquote>
Example:
<p>FORMAT NIC switchover to slot $3, port $4 from slot $5, port $6
<p>Note: The trap OID, severity, category and hostname will always be prepended
to the FORMAT string in both the text log and syslog.&nbsp; The text log
will also have the date prepended at the beginning.
<br>&nbsp;</blockquote>
<b>EXEC:</b>
<blockquote>[<b>EXEC</b> command_string]
<p>Optional string containing command to execute when trap is received
and arguments to pass to the program.
<p>EXEC uses same variable substitution as the FORMAT line.
<p>Example:
<p>EXEC /usr/bin/qpage -f TRAP alex "$r: $x $X - NIC switchover to slot
$3, port $4 from slot $5, port $6"
<p>or
<p>EXEC c:\snmp\pager netops "$r: $x $X - NIC switchover to slot $3, port
$4 from slot $5, port $6"
<p>Note: Unlike the FORMAT line, nothing is prepended to the message.&nbsp;
If you would like to include the hostname and date in the page above, you
must use the variables such as $r, $x and $X.
<br>&nbsp;</blockquote>
<b>NODES:</b>
<blockquote>[<b>NODES</b> sources_list]
<p>Optional string containing a list of source (host) names separated by
spaces that must match for this trap handle definition to be used.&nbsp;
If this keyword omitted then ALL sources will be accepted.
<p>Optionally a file can be specified which will contain the list of sources.
<p>This list must be specified with a full path
<p>Examples:
<blockquote>NODES fred barney betty wilma
<br>NODES /etc/snmptt-nodes
<br>&nbsp; or
<br>NODES c:\snmp\snmptt-nodes</blockquote>
where snmptt-nodes contains:
<blockquote>fred
<br>barney
<br># comment lines
<br>192.168.1.1
<br>192.168.2.1
<br>betty
<br>wilma</blockquote>
Note:&nbsp;&nbsp; The names are NOT case sensitive, comment lines are permitted
by starting the line with a # and IP addresses can also be used.
<p>Note:&nbsp;&nbsp; If you are using DNS, the names may resolve to the
Fully Qualified Domain Name (FQDN) by snmptrapd.&nbsp; For example: barney.bedrock.com.
<p>Adding an entry for the host in your /etc/hosts file or c:\%systemroot%\system32\drivers\etc\hosts
should result in snmptrapd sending the short name instead (barney).
<br>&nbsp;</blockquote>
<b>SDESC</b>
<blockquote>[<b>SDESC</b>]
<p>Optional start of a description.&nbsp; All text between this line and
the line EDESC will be ignored by snmptt. This section can be used to enter
comments about the trap for your own use.&nbsp; If you use a SDESC, you
MUST follow with a EDESC.</blockquote>
<b>EDESC</b>
<blockquote>[<b>EDESC</b>]
<p>Used to end the description section.
<p>Example:
<blockquote>SDESC
<br>Trap used when power supply fails in
<br>a server.
<br>EDESC</blockquote>
</blockquote>
</blockquote>

<p><br><a NAME="SNMPTT.CONF Configuration file Notes"></a><b><font size=+2>SNMPTT.CONF
Configuration file Notes</font></b>
<p>When there are multiple definitions of the same trap in the configuration
file, the following rules apply:
<p><b>A match occurs when:</b>
<ul>
<li>
The received trap OID matches a defined OID in the configuration file</li>

<li>
<b>AND</b> <b>( </b>the hostname matches a defined hostname int the NODES
entry <b>OR</b> the NODES entry is blank<b>)</b></li>
</ul>
<b>If multiple_event is set to 1 in snmptt.ini:</b>
<ul>
<li>
A trap is handled as many times as it matches in the configuration file</li>

<li>
If any number of exact matches exist, the wildcard match is NOT performed</li>

<li>
If an exact match does NOT exist, the wildcard match IS performed</li>
</ul>
<b>If multiple_event is set to 0 in snmptt.ini:</b>
<ul>
<li>
A trap is handled once using the first match in the configuration file</li>

<li>
If an exact match exists, the wildcard match is NOT performed</li>

<li>
If an exact match does NOT exist, the wildcard match IS performed</li>
</ul>
<a NAME="Sample1 SNMPTT.CONF file"></a><b><font size=+2>Sample1 SNMPTT.CONF
file</font></b>
<p>Following is a sample of two defined traps in <b>snmptt.conf:</b>
<blockquote>#
<br>EVENT COMPAQ_11003 .1.3.6.1.4.1.232.0.11003 "LOGONLY" Normal
<br>FORMAT Compaq Generic Trap: $*
<br>EXEC qpage -f TRAP notifygroup1 "Compaq Generic Trap: $*"
<br>NODES /etc/snmp/cpqnodes
<br>SDESC
<br>Generic test trap
<br>EDESC
<br>#
<br>#
<br>EVENT cpqDa3AccelBatteryFailed .1.3.6.1.4.1.232.0.3014 "Error Events"
Critical
<br>FORMAT Battery status is $3.
<br>EXEC qpage -f TRAP notifygroup1 "$s $r $x $X: Battery status is $3"
<br>NODES ntserver1 ntserver2 ntserver3
<br>#
<br>#</blockquote>
<a NAME="Sample2 SNMPTT.CONF file"></a><b><font size=+2>Sample2 SNMPTT.CONF
file</font></b>
<p>Following is a sample of a list of files to load in <b>snmptt.ini:</b>
<blockquote>snmptt_conf_files = &lt;&lt;END
<br>/etc/snmp/snmp-compaq.conf
<br>/etc/snmp/snmp-compaq-hsv.conf
<br>END</blockquote>
Following is a sample of one defined traps in <b>/etc/snmp/snmptt-compaq.conf:</b>
<blockquote>#
<br>EVENT COMPAQ_11003 .1.3.6.1.4.1.232.0.11003 "LOGONLY" Normal
<br>FORMAT Compaq Generic Trap: $*
<br>EXEC qpage -f TRAP notifygroup1 "Compaq Generic Trap: $*"
<br>NODES /etc/snmp/cpqnodes
<br>SDESC
<br>Generic test trap
<br>EDESC
<br>#</blockquote>
Following is a sample of one defined traps in <b>/etc/snmp/snmptt-compaq-hsv.conf:</b>
<blockquote>#
<br>EVENT mngmtAgentTrap-16025 .1.3.6.1.4.1.232.0.136016025 "Status Events"
Normal
<br>FORMAT Host $1 : SCellName-TimeDate $2 : EventCode $3 : Description
$4
<br>EXEC qpage -f TRAP notifygroup1 "Host $1 : SCellName-TimeDate $2 :
EventCode $3 : Description $4"
<br>SDESC
<br>"Ema EMU Internal State Machine Error [status:10]"
<br>EDESC
<br>#</blockquote>

<p><br><a NAME="Notes"></a><b><font size=+2>Notes</font></b>
<p>An existing HP Openview trapd.conf can be used in most cases but the
file must be a VERSION 3 file.&nbsp; SNMPTT does not support all the variables
implemented in HPOV, but most are available.&nbsp; The following variables
may or may not match exactly to HPOV: $O, $o, $r, $ar, $R, $aR.
<p>Some vendors (such as Compaq and Cisco ) provide a file that can be
imported in to HP Openview using an HP Openview utility.&nbsp; Snmpttconvert
can be used to convert the file to snmptt.conf format.
<p>Some vendors provide a MIB file that contains trap or notify definitions.&nbsp;
Snmpttconvertmib can be used to convert the file to snmptt.conf format.
<br>&nbsp;
<p><a NAME="Installation - Unix"></a><b><font size=+2>Installation - Unix</font></b>
<p>1.&nbsp; <b><u>Read this entire file to understand how snmptt works</u></b>
<p>2.&nbsp; Copy <b>snmptt</b> to /usr/sbin/ and ensure it is executable
(<b>chmod +x snmptt</b>)
<p>3.&nbsp; Copy <b>snmptthandler</b> to /usr/sbin/ and ensure it is executable
(<b>chmod +x snmptthandler</b>)
<p>4.&nbsp; Copy <b>snmptt.ini</b> to <b>/etc/snmp/ </b>and edit the options
inside the file.
<p>5a.&nbsp;&nbsp; For <b>standlone mode:&nbsp; </b>Modify the NET-SNMP
snmptrapd.conf file by adding the following line:
<blockquote><b>traphandle default /usr/sbin/snmptt</b>
<p>Note:&nbsp;&nbsp; It is possible to configure snmptrapd to execute snmptt
based on the trap received, but using the default option is preferred</blockquote>
5b.&nbsp;&nbsp; For <b>daemon mode:&nbsp;</b> Modify the NET-SNMP snmptrapd.conf
file by adding the following line:
<blockquote><b>traphandle default /usr/sbin/snmptthandler</b>
<p>Launch snmptt using:
<p><b>snmptt --daemon</b></blockquote>

<blockquote>A startup script is included which can be used to start and
stop <b>snmptt</b> on Mandrake, RedHat and other systems.&nbsp; Copy the
script to the init.d directory:
<p><b>cp snmptt.init.d to /etc/rc.d/init.d/snmptt</b>
<p>Add the service using chkconfig:
<p><b>chkconfig --add snmptt</b>
<p>Configure the service to start at runlevel 2345:
<p><b>chkconfig --level 2345 snmptt on</b>
<p>Snmptt will be started at the next reboot, or can be started immediately
with:
<p><b>service snmptt start</b>
<p>or
<p><b>/etc/rc.d/init.d/snmptt start</b></blockquote>
6.&nbsp; Start SNMPTRAPD using the command line:&nbsp; SNMPTRAPD -On.
<br>&nbsp;&nbsp;&nbsp;&nbsp; You should be able to edit the <b>/etc/rc.d/init.d/snmptrapd</b>
script if you have one and change
<br>&nbsp;&nbsp;&nbsp;&nbsp; the <b>OPTIONS</b> to <b>"-On"</b>. <b>The
-On is required otherwise snmptt will NOT recognize the traps.</b>
<br>&nbsp;
<p><a NAME="Installation - Windows"></a><b><font size=+2>Installation -
Windows</font></b>
<p>1.&nbsp; <b><u>Read this entire file to understand how snmptt works</u></b>
<p>2.&nbsp; Create the directory c:\snmp and copy <b>snmptt</b> and <b>snmptthandler</b>
to it
<p>3.&nbsp; Copy <b>snmptt.ini-nt</b> to <b>%SystemRoot%\snmptt.ini</b>
(c:\winnt\snmptt.ini)<b> </b>and edit the options inside the file.
<p>4a.&nbsp;&nbsp; For <b>standlone mode:&nbsp; </b>Modify the NET-SNMP
snmptrapd.conf file by adding the following line:
<blockquote><b>traphandle default perl c:\snmp\snmptt</b></blockquote>

<blockquote>Note:&nbsp;&nbsp; It is possible to configure snmptrapd to
execute snmptt based on the trap received, but using the default option
is preferred</blockquote>
4b.&nbsp;&nbsp; For <b>daemon mode:&nbsp;</b> Modify the NET-SNMP snmptrapd.conf
file by adding the following line:
<blockquote><b>traphandle default perl c:\snmp\snmptthandler</b>
<p>Launch snmptt using:
<p><b>snmptt --daemon</b></blockquote>
5.&nbsp; Start SNMPTRAPD using the command line:&nbsp; SNMPTRAPD -On.
<b>The
-On is required otherwise snmptt will NOT recognize the traps.</b>
<br>&nbsp;
<p><b><u><font size=+1>Windows NT Service:</font></u></b>
<p>To configure SNMPTT as a service under Windows NT, follow these steps.&nbsp;
More information can be obtained from the Windows NT Resource Kit.
<p>1.&nbsp;&nbsp;&nbsp; Install the Windows NT resource kit
<p>2.&nbsp;&nbsp;&nbsp; Copy the <b>srvany.exe</b> program to <b>c:\winnt\system32</b>
from <b>c:\Program Files\Resource Kit *</b>
<p>3.&nbsp;&nbsp;&nbsp; Install the SNMPTT service using:
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b> instsrv SNMPTT c:\winnt\system32\srvany.exe</b>
<p>4.&nbsp;&nbsp;&nbsp; Configure the service:
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Launch <b>REGEDIT</b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Go to <b>HKLM\SYSTEM\CurrentControlSet\SNMPTT</b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Create a key called: 
<b>Parameters</b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inside of Parameters, create
a Sting Value (REG_SZ) called <b>Application</b> with the value of: <b>c:\perl\bin\perl.exe</b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Inside of Parameters, create
a Sting Value (REG_SZ) called <b>AppParameters</b> with the value of: <b>c:\snmp\snmptt
--daemon</b>
<p>5.&nbsp;&nbsp;&nbsp; Start the service from the control panel, or from
a command prompt, type:&nbsp; <b>net start snmptt</b>
<p>To remove the service, type:&nbsp; <b>instsrv SNMPTT remove</b>
<br>&nbsp;
<p><a NAME="Limitations"></a><b><font size=+2>Limitations</font></b>
<p><b><font size=+1>Standalone mode only:</font></b>
<p>With a 450 Mhz PIII and a 9000 line snmptt.conf containing 566 unique
traps (EVENTs), it takes under a second to process the trap including logging
and executing the qpage program.&nbsp; The larger the snmptt.conf file
is, the longer it will take to process.&nbsp; If there are a large number
of traps being received, daemon mode should be used.&nbsp; If it takes
1 second to process one trap, then obviously you shouldn't try to process
more than one trap per second.
<p><b><font size=+1>Standalone or daemon mode:</font></b>
<p>The SNMPTRAPD program blocks when executing traphandle commands.&nbsp;
This means that if the program called never quits, SNMPTRAPD will wait
forever.&nbsp; If a trap is received while the traphandler is running,
it is buffered and will be processed when the traphandler finishes.&nbsp;
I do not know how large this buffer is.
<p>The program called by SNMPTT (EXEC) blocks SNMPTT.&nbsp; If you call
a program that does not return, SNMPTT will be left waiting.&nbsp; In standalone
mode, this would cause snmptrapd to wait forever also.
<br>&nbsp;
<p><a NAME="Feedback"></a><b><font size=+2>Feedback</font></b>
<p>Please send me any comments - good or bad - to alex_b@users.sourceforge.net.&nbsp;
If you have any problems including converting trap files, please send me
an email and include the file you are trying to convert and I will try
to take a look at it.
<p>Please also send any patches or improvments so I can add them in to
the CVS tree.
<br>&nbsp;
<p><a NAME="SNMP Trap Translator Convert"></a><b><font size=+3>SNMP Trap
Translator Convert v0.1</font></b>
<br><b><font size=+1>(SNMPTTCONVERT)</font></b>
<p>Some vendors provide a file that can be imported into HP Openview using
a HP Openview utiltity.&nbsp; SNMPTTCONVERT is a simple Perl script which
will convert one of these files into the format used by SNMPTT.&nbsp; The
file can contain multiple traps.
<p>For example, if the file ciscotrap.txt contained:
<blockquote>rpsFailed {.1.3.6.1.4.1.437.1.1.3} 6 5 - "Status Events" 1
<br>Trap received from enterprise $E with $# arguments: sysName=$1
<br>SDESC
<br>"A redundant power source is connected to the switch but a failure
exists in
<br>the power system."
<br>EDESC</blockquote>
Executing snmpttconvert ciscotrap.txt would output:
<blockquote>#
<br>#
<br>#
<br>EVENT rpsFailed .1.3.6.1.4.1.437.1.1.3.0.5 "Status Events" Normal
<br>FORMAT Trap received from enterprise $E with $# arguments: sysName=$1
<br>#EXEC qpage -f TRAP notifygroup1 "Trap received from enterprise $E
with $# arguments: sysName=$1"
<br>SDESC
<br>"A redundant power source is connected to the switch but a failure
exists in
<br>the power system."
<br>EDESC</blockquote>

<p><br>Note:&nbsp; The #EXEC line is added by default.&nbsp; This can be
changed by editing the SNMPTTCONVERT script.
<br>&nbsp;
<p><a NAME="SNMP Trap Translator Convert MIB"></a><b><font size=+3>SNMP
Trap Translator Convert MIB v0.1</font></b>
<br><b><font size=+1>(SNMPTTCONVERTMIB)</font></b>
<p><b>SNMPTTCONVERTMIB</b> is a Perl script which will read a MIB file
and convert the <b>TRAP-TYPE</b> (v1) or <b>NOTIFICATION-TYPE</b> (v2)
definitions into a configuration file readable by <b>SNMPTT</b>.
<p>For example, if the file <b>CPQHOST.mib</b> (v1) contained:
<blockquote>CPQHOST-MIB DEFINITIONS ::= BEGIN
<p>&nbsp;&nbsp;&nbsp; IMPORTS
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; enterprises&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FROM RFC1155-SMI
<br>.
<br>.
<br>. (lines removed)
<br>.
<br>.
<br>&nbsp;&nbsp;&nbsp; cpqHo2NicSwitchoverOccurred2 TRAP-TYPE
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ENTERPRISE compaq
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; VARIABLES { sysName, cpqHoTrapFlags,
cpqHoIfPhysMapSlot,
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cpqHoIfPhysMapPort, cpqHoIfPhysMapSlot,
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
cpqHoIfPhysMapPort }
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DESCRIPTION
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
"This trap will be sent any time the configured redundant NIC
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
becomes the active NIC."
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
--#TYPE "Status Trap"
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
--#SUMMARY "NIC switchover to slot %s, port %s from slot %s, port %s."
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
--#ARGUMENTS {2, 3, 4, 5}
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
--#SEVERITY MAJOR
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
--#TIMEINDEX 99
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ::= 11010
<br>&nbsp;</blockquote>
Executing <b>snmpttconvertmib CPQHOST.mib snmptt.conf </b>would APPEND
to the end of the <b>snmptt.conf</b> file (specified on the command line):
<blockquote>#
<br>#
<br>#
<br>EVENT cpqHo2NicSwitchoverOccurred2 .1.3.6.1.4.1.232.0.11010 "Status
Events" Normal
<br>FORMAT NIC switchover to slot $3, port $4 from slot $5, port $6.
<br>#EXEC qpage -f TRAP notifygroup1 "NIC switchover to slot $3, port $4
from slot $5, port $6."
<br>SDESC
<br>This trap will be sent any time the configured redundant NIC
<br>becomes the active NIC.
<br>EDESC</blockquote>

<p><br>Note:&nbsp; The #EXEC line is added by default.&nbsp; This can be
changed by editing the <b>SNMPTTCONVERTMIB</b> script.
<p><b><font size=+2>Requirements</font></b>
<ul>
<li>
UCD-SNMP / NET-SNMP <b>snmptranslate</b> utility</li>
</ul>

<p><br><b><font size=+2>Converting a MIB file</font></b>
<p>Follow these steps to successfully convert a MIB file:
<br>&nbsp;
<ol>
<li>
Edit the options between OPTIONS START and OPTIONS END in snmpttconvertmib</li>

<li>
Copy the MIB file to UCD-SNMP / NET-SNMP mibs folder</li>

<li>
Type: <b>EXPORT MIBS=ALL</b> to ensure all the mibs will be read in by
<b>snmptranslate</b></li>

<li>
Make sure the MIB file can be interpreted by <b>snmptranlate</b> correctly.&nbsp;
Simply typing <b>snmptranslate</b> should tell you if it was able to read
the mib file correctly.&nbsp; If it can't, an error will be produced at
the top of the help screen.</li>

<li>
Convert the mib file with: <b>snmpttconvertmib <i>path-to-mib</i> <i>output-file-name</i></b>.&nbsp;
Note:&nbsp; the <b>output-file-name</b> is appended to, so remember to
delete it first if needed.</li>
</ol>
Example:
<blockquote><b>snmpttconvertmib /usr/share/snmp/mibs/CPQHOST.mib /etc/snmp/snmptt-compaqhost.conf</b></blockquote>

<p><br><b><font size=+2>How it works</font></b>
<br>&nbsp;
<p><b><font size=+1>SNMP V1 files (TRAP-TYPE):</font></b>
<p>Some MIB files contain <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> lines
which are used by Novell's Network Management system.&nbsp; These MIB files
convert very well to <b>SNMPTT</b> as they contain detailed information
that can be used on the <b>FORMAT</b> and <b>EXEC</b> lines.&nbsp; Compaq's
MIBs usually have these lines.
<p>Other MIBS contain only a <b>DESCRIPTION</b> section where the first
line contains the <b>FORMAT</b> string.&nbsp; In some MIBS, this line also
contains variables similar to the <b>--#SUMMARY</b> lines.
<p>The mib file is searched for lines containing <b>TRAP-TYPE</b>.&nbsp;
If it finds one that appears to be a valid trap definition, it reads in
the following lines until a ::= is found while looking for the <b>ENTERPRISE</b>
and <b>DESCRIPTION</b> section.&nbsp; It then looks for the <b>--#SUMMARY</b>
and <b>--#ARGUMENTS</b> line.
<p>The value for the <b>ENTERPRISE</b> is used when looking up the <b>TRAP-TYPE</b>.
<b>SNMPTRANSLATE</b>
is used with the following syntax to find the <b>OID</b> of the trap:
<p><b>snmptranslate -IR -Ts <i>enterprise</i>#.<i>trapname</i></b>
<p>MIB files can become quite complex to read due to the use of IMPORT
statements etc.&nbsp; This is why snmptranslate is used.
<p>If <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> are found, the <b>%<i>letter</i></b>
variables are replaced with <b>$<i>number</i></b> variables based on the
values lists in the <b>--#ARGUMENTS</b> section incrememented by 1 (ARGUMENTS
starts with 0, SNMPTT starts with 1).&nbsp; This will be used to define
the <b>FORMAT</b> and <b>EXEC</b> lines.
<p>If there is no <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> lines, but
the first line of the <b>DESCRIPTION</b> contains <b>%<i>letter</i></b>
variables, then that line will be used to define the <b>FORMAT</b> and
<b>EXEC</b>
lines.&nbsp; The <b>%<i>letter</i></b> variables are replaced with <b>$<i>number</i></b>
variables starting at 1 and going up.
<p>If there is no <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> lines, and
the first line of the <b>DESCRIPTION</b> does not contain <b>%<i>letter</i></b>
variables, then that line will be used to define the <b>FORMAT</b> and
<b>EXEC</b>
lines followed by a <b>$*</b> which will dump all received variables.
<br>&nbsp;
<p><b><font size=+1>SNMP V2 files (NOTIFICATION-TYPE):</font></b>
<p>The mib file is searched for lines containing <b>NOTIFICATION-TYPE</b>.&nbsp;
If it finds one that appears to be a valid trap definition, it reads in
the following lines until a ::= is found while looking for the <b>DESCRIPTION</b>
section. It then looks for the <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b>
line.&nbsp; I have never seen a V2 file with the&nbsp; <b>--#SUMMARY</b>
and <b>--#ARGUMENTS</b> lines in them, but I have left the code in place
in case they exist.
<p>The value for the <b>ENTERPRISE</b> is used when looking up the <b>NOTIFICATION-TYPE</b>.
<b>SNMPTRANSLATE</b>
is used with the following syntax to find the <b>OID</b> of the trap:
<p><b>snmptranslate -IR -Ts <i>enterprise</i>.<i>trapname</i></b>
<p>MIB files can become quite complex to read due to the use of IMPORT
statements etc.&nbsp; This is why snmptranslate is used.
<p>If <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> are found, the <b>%<i>letter</i></b>
variables are replaced with <b>$<i>number</i></b> variables based on the
values lists in the <b>--#ARGUMENTS</b> section incrememented by 1 (ARGUMENTS
starts with 0, SNMPTT starts with 1).&nbsp; This will be used to define
the <b>FORMAT</b> and <b>EXEC</b> lines.
<p>If there is no <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> lines, but
the first line of the <b>DESCRIPTION</b> contains <b>%<i>letter</i></b>
variables, then that line will be used to define the <b>FORMAT</b> and
<b>EXEC</b>
lines.&nbsp; The <b>%<i>letter</i></b> variables are replaced with <b>$<i>number</i></b>
variables starting at 1 and going up.
<p>If there is no <b>--#SUMMARY</b> and <b>--#ARGUMENTS</b> lines, and
the first line of the <b>DESCRIPTION</b> does not contain <b>%<i>letter</i></b>
variables, then that line will be used to define the <b>FORMAT</b> and
<b>EXEC</b>
lines followed by a <b>$*</b> which will dump all received variables.
<br>&nbsp;
<p><b><font size=+2>Troubleshooting</font></b>
<p>If you find that the MIB file is not converting properly, make sure
it does not contain DOS carriage returns.&nbsp; Displaying the file with
the joe editor will show <b><u>M</u></b>'s at the end of each line.&nbsp;
To create a new file without them, type:
<p><b>cat <i>mib-file</i> | tr -d '\015' > <i>mib-file.new</i></b>
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
</body>
</html>
